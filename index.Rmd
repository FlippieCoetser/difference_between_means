---
title: "Estimating a p value for the difference in means between two groups"
author: "PJ Coetser"
date: "12/3/2021"
output:
  html_document:
    highlight: textmate
    css: styles.css
    self_contained: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

> **Note:** this code is a direct copy of Dr Juan Klopper youtube video ([link](https://www.youtube.com/watch?v=XRrx95pc_Pw)) and intended for educational purposes only. Obvious and notable differences includes code written in R.

TODO: Added math equations, additional information and update aesthetics.


# Resampling under the null hypothesis

## In this tutiorial

- Seeding the pseudo-random number generator for reproducible results
- Creating a Dataframe
- Sample from a set of categorical values using sample function
- Sample from a normal distribution using rnorm function
- Making sub-DataFrames using the filter function (conditional selection)
- Extracting vectors from DataFrames using dplyr
- Summary statistics of a continuous numerical variable using summary function
- Histogram using ggplot
- Shuffle a vector sample function
- Calculate a p-value using t.test function

## Packages

```{r, message=FALSE}
library(dplyr)
library(ggplot2)
```

## Population Data

Sample Size
```{r}
n <- 1000
```

Configure pseudo-random number generator and define group probability
```{r}
set.seed(12)
group_probability <- c(0.479,0.521)
```
> Note: group probabilities are used to mimic the number of samples included in each group, as observed in youtube

Define parameters used for data generation
```{r}
groups <- c('I','II')
mass_mean <- 100
mass_sd <- 10
```

Generate population data set
```{r}
df <- data.frame(
  ID = 1:n,
  Group = replicate(n,sample(groups,size = 1, prob = group_probability)),
  Mass = rnorm(n, mass_mean, mass_sd))

```

## Sample Data Sets

Extract two sample data sets from population based on group
```{r}
group_I <- df |> filter(Group == 'I')
group_II <- df |> filter(Group == 'II')
```

Extract Vectors from sample data sets 
```{r}
mass <- df[['Mass']]

mass_I <- group_I[['Mass']]
mass_II <- group_II[['Mass']]

n_I <- length(mass_I)
n_II <- length(mass_II)
```


## Descriptive Statistics
### Sample Data Set I
```{r}
summary(mass_I)
```
### Sample Data II
```{r}
summary(mass_II)
```

## Data Visualization
Plot histogram of both sample data sets overlayd on top of each other
```{r}
ggplot(df, aes(
  x=Mass, 
  fill=Group)) + 
  geom_histogram(
    position = "identity",
    alpha=0.5, 
    bins = 30)
```

## Difference in means (test statistic)
```{r}
difference_in_means <- mean(mass_I) - mean(mass_II)
```

## Reassignment under the null hypothesis
Use random samples extracted from the population data set to generate an entire spectrum of differences between mean values 
```{r}
means <- c()
resamples <- 5000

for (i in 1:resamples ) {
  shuffled_mass <- sample(mass)
  new_group_I <- shuffled_mass[1:n_I]
  new_group_II <- shuffled_mass[(n_I + 1):n]
  new_difference_in_means = mean(new_group_I) - mean(new_group_II)
  means <- means |> append(new_difference_in_means)
}
```

Plot spectrum of differences between mean values
```{r}
ggplot(mapping = aes(means)) + 
  geom_histogram(
    position = "identity",
    alpha=0.5, 
    bins = 30)
```

## Probablity of difference in means
p-value of the difference between the two mean values of **mass_I** and **mass_II** sample data sets
### Manually calculated
```{r}
qty_smaller_than_difference <- length(means[means < -difference_in_means])
qty_bigger_than_difference <- length(means[means > difference_in_means])

p_value.manual <- (qty_smaller_than_difference + qty_bigger_than_difference) / resamples
print(round(p_value.manual,4))
```

### Calculated using Equal Variance T-Test function
```{r}
p_value.package <- t.test(mass_I, mass_II, alternative = "two.sided", var.equal = FALSE)[['p.value']]
print(round(p_value.package,4))
```

